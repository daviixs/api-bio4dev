// ------------------ GENERATOR & DATASOURCE ------------------
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat = "cjs"
}

generator erd {
  provider = "prisma-erd-generator"
  theme = "dark"
}

datasource db {
  provider = "postgresql"
}


// ------------------ USER ------------------
model User {
  id        String    @id @default(uuid()) @db.Uuid
  email     String    @unique @db.VarChar(180)
  senha     String    @db.Text
  nome      String    @db.VarChar(120)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  profile   Profile[]  // Permite múltiplos profiles
}


// ------------------ PROFILE ------------------
model Profile {
  id                String        @id @default(uuid()) @db.Uuid
  userId            String        @db.Uuid  // Remove @unique - permite múltiplos profiles
  username          String        @unique @db.VarChar(40)
  slug              String        @unique @db.VarChar(60)  // URL única
  bio               String?       @db.Text
  avatarUrl         String?       @db.Text
  theme             Colors        @default(LIGHT) // Tema claro ou escuro
  mainColor         String?       @db.VarChar(7)  // Cor principal em hexadecimal (ex: #FF5733)
  templateType      TemplateType  // Template de bio obrigatório
  published         Boolean       @default(false)
  isActive          Boolean       @default(false)  // Apenas 1 ativo por user
  templateSourceId  String?       @db.Uuid  // ID do profile usado como template
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  // Relations
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  templateSource    Profile?          @relation("TemplateSource", fields: [templateSourceId], references: [id])
  clonedFrom        Profile[]         @relation("TemplateSource")
  pages             Page[]
  social            Social[]
  legendas          Legenda[]
  projetos          Projeto[]
  linkButtons       LinkButton[]
  config            Config?
  techStack         TechStack?
  workHistory       WorkExperience[]
  footer            Footer?
  templates         Template[]
  previewTokens     PreviewToken[]

  @@index([userId])
  @@index([slug])
  @@index([userId, isActive])
}


// ------------------ PREVIEW TOKEN ------------------
model PreviewToken {
  id        String   @id @default(uuid()) @db.Uuid
  profileId String   @db.Uuid
  token     String   @unique @default(uuid()) @db.Uuid
  expiresAt DateTime
  createdAt DateTime @default(now())

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([profileId])
}


// ------------------ PAGE ------------------
model Page {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @db.Uuid
  titulo    String    @db.VarChar(120)
  slug      String    @unique @db.VarChar(100)
  ordem     Int?
  createdAt DateTime  @default(now())

  profile   Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  custom    Custom[]
  templates TemplatePage[]

  @@index([profileId])
}


// ------------------ CUSTOM BLOCK ------------------
model Custom {
  id        String    @id @default(uuid()) @db.Uuid
  pageId    String    @db.Uuid
  tipo      TipoBloco
  ordem     Int
  titulo    String?   @db.VarChar(120)
  conteudo  Json
  ativo     Boolean   @default(true)
  createdAt DateTime  @default(now())

  page      Page      @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@index([pageId])
}

enum TipoBloco {
  link
  texto
  imagem
  botao
  lista
  spotify
  youtube
  tiktok
}


// ------------------ SOCIAL ACCOUNT ------------------
model Social {
  id          String      @id @default(uuid()) @db.Uuid
  profileId   String      @db.Uuid
  plataforma  Plataforma
  url         String      @db.Text
  ordem       Int

  profile     Profile     @relation(fields: [profileId], references: [id], onDelete: Cascade)
  templates   TemplateSocial[]

  @@index([profileId])
}

enum Plataforma {
  instagram
  tiktok
  youtube
  github
  linkedin
  twitter
  facebook
  figma
  devto
  dev
  email
  behance
  dribbble
  medium
  pinterest
  gitlab
  bitbucket
  stackoverflow
  codepen
  discord
  whatsapp
  telegram
}


// ------------------ LEGENDA ------------------
model Legenda {
  id          String    @id @default(uuid()) @db.Uuid
  profileId   String    @db.Uuid
  greeting    String?   @db.VarChar(100)
  legendaFoto String    @db.Text
  nome        String
  titulo      String
  subtitulo   String
  descricao   String    @db.Text
  createdAt   DateTime  @default(now())

  profile     Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  templates   Template[]

  @@index([profileId])
}


// ------------------ PROJETO ------------------
model Projeto {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @db.Uuid
  nome      String
  descricao String    @db.Text
  demoLink  String?   @db.Text
  codeLink  String?   @db.Text
  ordem     Int       @default(0)
  gif       String?   @db.Text
  tags      String[]  @default([])
  createdAt DateTime  @default(now())

  profile   Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  templates Template[]

  @@index([profileId])
}


// ------------------ LINK BUTTON (para influenciadores) ------------------
model LinkButton {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @db.Uuid
  label     String    @db.VarChar(100)
  url       String    @db.Text
  subtext   String?   @db.VarChar(200)
  icon      String?   @db.VarChar(50)
  style     String?   @db.VarChar(100)
  ordem     Int       @default(0)
  ativo     Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  profile   Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}


// ------------------ CONFIG ------------------
model Config {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @unique @db.Uuid
  stacks    Int
  projetos  Int
  createdAt DateTime  @default(now())

  profile   Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  templates Template[]

  @@index([profileId])
}


// ------------------ TEMPLATE ------------------
model Template {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @db.Uuid // (antigo id_user) referencia Profile
  legendaId String    @db.Uuid
  projetoId String    @db.Uuid
  configId  String    @db.Uuid
  createdAt DateTime  @default(now())

  // Relations
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  legenda   Legenda  @relation(fields: [legendaId], references: [id], onDelete: Cascade)
  projeto   Projeto  @relation(fields: [projetoId], references: [id], onDelete: Cascade)
  config    Config   @relation(fields: [configId], references: [id], onDelete: Cascade)

  social    TemplateSocial[]
  pages     TemplatePage[]

  @@index([profileId])
  @@index([legendaId])
  @@index([projetoId])
  @@index([configId])
}


// ------------------ TEMPLATE SOCIAL (JOIN TABLE) ------------------
model TemplateSocial {
  id         String    @id @default(uuid()) @db.Uuid
  templateId String    @db.Uuid
  socialId   String    @db.Uuid
  
  template   Template  @relation(fields: [templateId], references: [id], onDelete: Cascade)
  social     Social    @relation(fields: [socialId], references: [id], onDelete: Cascade)

  @@unique([templateId, socialId])
  @@index([templateId])
  @@index([socialId])
}


// ------------------ TEMPLATE PAGE (JOIN TABLE) ------------------
model TemplatePage {
  id         String    @id @default(uuid()) @db.Uuid
  templateId String    @db.Uuid
  pageId     String    @db.Uuid
  
  template   Template  @relation(fields: [templateId], references: [id], onDelete: Cascade)
  page       Page      @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([templateId, pageId])
  @@index([templateId])
  @@index([pageId])
}


// ------------------ ENUMS ------------------
enum Colors {
  LIGHT
  DARK
}

enum TemplateType {
  template_01  // Dev/Tech
  template_02  // Design/Creative
  template_03  // Business/Corporate
  template_04  // Fitness Influencer
  template_05  // Musician/Artist
  template_06  // Photographer
  template_07  // Coach/Mentor
  template_08  // Food Blogger
  template_09  // Travel Influencer
  template_10  // Fashion Influencer
  template_11  // Gaming Streamer
  template_12  // Gourmet
  template_13  // Innovation
  template_14  // Streamer
}


// ------------------ TECH STACK ------------------
model TechStack {
  id           String       @id @default(uuid()) @db.Uuid
  profileId    String       @unique @db.Uuid
  title        String       @db.VarChar(100)
  subtitle     String       @db.VarChar(200)
  
  profile      Profile      @relation(fields: [profileId], references: [id], onDelete: Cascade)
  technologies Technology[]

  @@index([profileId])
}

model Technology {
  id          String    @id @default(uuid()) @db.Uuid
  techStackId String    @db.Uuid
  name        String    @db.VarChar(50)
  icon        String    @db.VarChar(50) 
  color       String    @db.VarChar(20) 
  ordem       Int       @default(0)

  techStack   TechStack @relation(fields: [techStackId], references: [id], onDelete: Cascade)

  @@index([techStackId])
}


// ------------------ WORK EXPERIENCE ------------------
model WorkExperience {
  id               String               @id @default(uuid()) @db.Uuid
  profileId        String               @db.Uuid
  company          String               @db.VarChar(100)
  period           String               @db.VarChar(50)
  summary          String               @db.Text
  impact           String?              @db.Text
  ordem            Int                  @default(0)

  profile          Profile              @relation(fields: [profileId], references: [id], onDelete: Cascade)
  technologies     WorkTechnology[]
  responsibilities WorkResponsibility[]

  @@index([profileId])
}

model WorkTechnology {
  id               String         @id @default(uuid()) @db.Uuid
  workExperienceId String         @db.Uuid
  technology       String         @db.VarChar(50)

  workExperience   WorkExperience @relation(fields: [workExperienceId], references: [id], onDelete: Cascade)

  @@index([workExperienceId])
}

model WorkResponsibility {
  id               String         @id @default(uuid()) @db.Uuid
  workExperienceId String         @db.Uuid
  responsibility   String         @db.Text
  ordem            Int            @default(0)

  workExperience   WorkExperience @relation(fields: [workExperienceId], references: [id], onDelete: Cascade)

  @@index([workExperienceId])
}


// ------------------ FOOTER ------------------
model Footer {
  id            String    @id @default(uuid()) @db.Uuid
  profileId     String    @unique @db.Uuid
  title         String    @db.VarChar(100)
  subtitle      String    @db.VarChar(200)
  email         String?   @db.VarChar(100)
  github        String?   @db.VarChar(100)
  linkedin      String?   @db.VarChar(100)
  twitter       String?   @db.VarChar(100)
  copyrightName String    @db.VarChar(100)
  madeWith      String?   @db.Text
  resumeUrl     String?   @db.Text

  profile       Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}
