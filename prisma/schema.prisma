// ------------------ GENERATOR & DATASOURCE ------------------
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}


// ------------------ USER ------------------
model User {
  id        String    @id @default(uuid()) @db.Uuid
  email     String    @unique @db.VarChar(180)
  senha     String    @db.Text
  nome      String    @db.VarChar(120)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  profile   Profile?
}


// ------------------ PROFILE ------------------
model Profile {
  id            String        @id @default(uuid()) @db.Uuid
  userId        String        @unique @db.Uuid
  username      String        @unique @db.VarChar(40)
  bio           String?       @db.Text
  avatarUrl     String?       @db.Text
  theme         Colors        @default(LIGHT) // Tema claro ou escuro
  mainColor     String?       @db.VarChar(7)  // Cor principal em hexadecimal (ex: #FF5733)
  templateType  TemplateType  // Template de bio obrigat√≥rio
  published     Boolean       @default(false)
  createdAt     DateTime      @default(now())

  // Relations
  user        User      @relation(fields: [userId], references: [id])
  pages       Page[]
  social      Social[]
  legendas    Legenda[]
  projetos    Projeto[]
  config      Config?
  techStack   TechStack?
  workHistory WorkExperience[]
  footer      Footer?
  templates   Template[]

  @@index([userId])
}


// ------------------ PAGE ------------------
model Page {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @db.Uuid
  titulo    String    @db.VarChar(120)
  slug      String    @unique @db.VarChar(100)
  ordem     Int?
  createdAt DateTime  @default(now())

  profile   Profile   @relation(fields: [profileId], references: [id])
  custom    Custom[]
  templates TemplatePage[]

  @@index([profileId])
}


// ------------------ CUSTOM BLOCK ------------------
model Custom {
  id        String    @id @default(uuid()) @db.Uuid
  pageId    String    @db.Uuid
  tipo      TipoBloco
  ordem     Int
  titulo    String?   @db.VarChar(120)
  conteudo  Json
  ativo     Boolean   @default(true)
  createdAt DateTime  @default(now())

  page      Page      @relation(fields: [pageId], references: [id])

  @@index([pageId])
}

enum TipoBloco {
  link
  texto
  imagem
  botao
  lista
  spotify
  youtube
  tiktok
}


// ------------------ SOCIAL ACCOUNT ------------------
model Social {
  id          String      @id @default(uuid()) @db.Uuid
  profileId   String      @db.Uuid
  plataforma  Plataforma
  url         String      @db.Text
  ordem       Int

  profile     Profile     @relation(fields: [profileId], references: [id])
  templates   TemplateSocial[]

  @@index([profileId])
}

enum Plataforma {
  instagram
  tiktok
  youtube
  github
  linkedin
  twitter
}


// ------------------ LEGENDA ------------------
model Legenda {
  id          String    @id @default(uuid()) @db.Uuid
  profileId   String    @db.Uuid
  greeting    String?   @db.VarChar(100)
  legendaFoto String    @db.Text
  nome        String
  titulo      String
  subtitulo   String
  descricao   String    @db.Text
  createdAt   DateTime  @default(now())

  profile     Profile   @relation(fields: [profileId], references: [id])
  templates   Template[]

  @@index([profileId])
}


// ------------------ PROJETO ------------------
model Projeto {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @db.Uuid
  nome      String
  descricao String    @db.Text
  demoLink  String?   @db.Text
  codeLink  String?   @db.Text
  ordem     Int       @default(0)
  gif       String
  createdAt DateTime  @default(now())

  profile   Profile   @relation(fields: [profileId], references: [id])
  templates Template[]

  @@index([profileId])
}


// ------------------ CONFIG ------------------
model Config {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @unique @db.Uuid
  stacks    Int
  projetos  Int
  createdAt DateTime  @default(now())

  profile   Profile   @relation(fields: [profileId], references: [id])
  templates Template[]

  @@index([profileId])
}


// ------------------ TEMPLATE ------------------
model Template {
  id        String    @id @default(uuid()) @db.Uuid
  profileId String    @db.Uuid // (antigo id_user) referencia Profile
  legendaId String    @db.Uuid
  projetoId String    @db.Uuid
  configId  String    @db.Uuid
  createdAt DateTime  @default(now())

  // Relations
  profile   Profile  @relation(fields: [profileId], references: [id])
  legenda   Legenda  @relation(fields: [legendaId], references: [id])
  projeto   Projeto  @relation(fields: [projetoId], references: [id])
  config    Config   @relation(fields: [configId], references: [id])

  social    TemplateSocial[]
  pages     TemplatePage[]

  @@index([profileId])
  @@index([legendaId])
  @@index([projetoId])
  @@index([configId])
}


// ------------------ TEMPLATE SOCIAL (JOIN TABLE) ------------------
model TemplateSocial {
  id         String    @id @default(uuid()) @db.Uuid
  templateId String    @db.Uuid
  socialId   String    @db.Uuid
  
  template   Template  @relation(fields: [templateId], references: [id])
  social     Social    @relation(fields: [socialId], references: [id])

  @@unique([templateId, socialId])
  @@index([templateId])
  @@index([socialId])
}


// ------------------ TEMPLATE PAGE (JOIN TABLE) ------------------
model TemplatePage {
  id         String    @id @default(uuid()) @db.Uuid
  templateId String    @db.Uuid
  pageId     String    @db.Uuid
  
  template   Template  @relation(fields: [templateId], references: [id])
  page       Page      @relation(fields: [pageId], references: [id])

  @@unique([templateId, pageId])
  @@index([templateId])
  @@index([pageId])
}


// ------------------ ENUMS ------------------
enum Colors {
  LIGHT
  DARK
}

enum TemplateType {
  template_01
  template_02
  template_03
}


// ------------------ TECH STACK ------------------
model TechStack {
  id           String       @id @default(uuid()) @db.Uuid
  profileId    String       @unique @db.Uuid
  title        String       @db.VarChar(100)
  subtitle     String       @db.VarChar(200)
  
  profile      Profile      @relation(fields: [profileId], references: [id])
  technologies Technology[]

  @@index([profileId])
}

model Technology {
  id          String    @id @default(uuid()) @db.Uuid
  techStackId String    @db.Uuid
  name        String    @db.VarChar(50)
  icon        String    @db.VarChar(50) 
  color       String    @db.VarChar(20) 
  ordem       Int       @default(0)

  techStack   TechStack @relation(fields: [techStackId], references: [id])

  @@index([techStackId])
}


// ------------------ WORK EXPERIENCE ------------------
model WorkExperience {
  id               String               @id @default(uuid()) @db.Uuid
  profileId        String               @db.Uuid
  company          String               @db.VarChar(100)
  period           String               @db.VarChar(50)
  summary          String               @db.Text
  impact           String?              @db.Text
  ordem            Int                  @default(0)

  profile          Profile              @relation(fields: [profileId], references: [id])
  technologies     WorkTechnology[]
  responsibilities WorkResponsibility[]

  @@index([profileId])
}

model WorkTechnology {
  id               String         @id @default(uuid()) @db.Uuid
  workExperienceId String         @db.Uuid
  technology       String         @db.VarChar(50)

  workExperience   WorkExperience @relation(fields: [workExperienceId], references: [id])

  @@index([workExperienceId])
}

model WorkResponsibility {
  id               String         @id @default(uuid()) @db.Uuid
  workExperienceId String         @db.Uuid
  responsibility   String         @db.Text
  ordem            Int            @default(0)

  workExperience   WorkExperience @relation(fields: [workExperienceId], references: [id])

  @@index([workExperienceId])
}


// ------------------ FOOTER ------------------
model Footer {
  id            String    @id @default(uuid()) @db.Uuid
  profileId     String    @unique @db.Uuid
  title         String    @db.VarChar(100)
  subtitle      String    @db.VarChar(200)
  email         String?   @db.VarChar(100)
  github        String?   @db.VarChar(100)
  linkedin      String?   @db.VarChar(100)
  twitter       String?   @db.VarChar(100)
  copyrightName String    @db.VarChar(100)

  profile       Profile   @relation(fields: [profileId], references: [id])

  @@index([profileId])
}
